# Модальные окна

## Триггер (кнопка, открывающая окно)
**Тег `<button> и <a>`
- `button` - для открытия модальных окон, не имеющих отдельных страниц (например, если окно предназначено для получения подтверждения о действии)
- `a` - для открытия модальных окно, имеющих отдельную запасную страницу. Её адрес указывается в атрибуте "href" (на случай, если JS не сработает или будет нажатие средней кнопкой мыши)

**Атрибут `data-trigger`
- Обозначает, что нажатие на элемент должно вызывать действие (открывать модальнок окно)
- ВАЖНО: просто убрав атрибут с элемента, позволяет отключить вызов события (например, чтобы написать свою логику его обработки)

**Атрибут `data-modal`
- Содержит уникальный ID модального окна, которое нужно открыть
- Пример: `data-modal="login"`

**Атрибут `aria-haspopup`
- Сообщает скринридерам, что кнопка вызывает всплывающее окно
- У атрибута могут и быть другие значения, но для модальных окон нужно указывать "dialog"
- Пример: `aria-haspopup="dialog"`


## Модальное окно
### Разметка
**Тег `section`
- Содержимое окна следует помещать в тег `<section>` в конце документа перед закрывающим `</body>`
- В будущем, возможно, можно будет использовать `<dialog>`, если улучшится поддержка

**Атрибут `id`
- Содержит уникальный идентификатор данного модального окна
- Пример: `<dialog id="modal1">`

**Атрибут `aria-modal`
- Сообщает скринридерам, что элементы под текущим диалоговым окном не должны быть доступны для взаимодействия (инертны)
- Пример: `aria-modal="true"`

**Атрибут `role`
- Сообщает скринридерам, что элемент является диалоговым окном
- Пример: `role="dialog"`

**Атрибут `tabindex`
- Управление возможностью поставить фокус на элемент с помощью клавиатуры
- В скрытом состоянии должно иметь значение "-1", при открытии окна "0"
- Пример: `tabindex="-1"`, `tabindex="0"`

**Атрибут `aria-labelledby`
- Содержит ID элемента, выступающего заголовком модального окна
- При открытии модального окна, скринридер озвучит его заголовок
- Пример: `aria-labelledby="modal1__title"`

**Атрибут `aria-describedby`
- Содержит ID элемента, выступающего текстовым содержимым модального окна. Если текстовых элементов много, следует обернуть их в один общий родитель и указать его ID
- При открытии модального окна, скринридер озвучит его описание (не уверен)
- Пример: `aria-describedby="modal1__desc"`


### Стилизация
**Скрыть/показать окно**
- *Для скрытия окна:*
  1. Убрать из дерева доступности (скрыть от скринридеров): атрибуту `aria-hidden` задать значение `true`
  2. Исключить из навигации с клавиатуры: атрибуту `tabindex` задать значение `-1`
  3. Скрыть визуально: добавить класс со свойствами `.srOnly` (modal--opened)
  4. Скрыть в браузере: добавить `visibility: hidden`, чтобы текстовое содержимое не находилось через поиск браузера
- *Для отображения окна:*
  1. Вернуть в дерево доступности (показать скринридерам): атрибуту `aria-hidden` задать значение `false`
  2. Вернуть в навигацию с клавиатуры: атрибуту `tabindex` задать значение `0`
  3. Отобразить визуально: удалить класс со свойствами `.srOnly` (modal--opened)
  4. Отобразить в браузере: `visibility: visible`


### Логика поведения
**Фокус при открытии**
- При открытии окна, фокус ставится на первый интерактивный элемент
- Если кроме кнопок интерактивных элементов нет, фокус ставится на кнопку, помеченную атрибутом `[data-focus]`

**Удержание фокуса в окне**
- При открытом модальном окне фокус переходит между элементами, расположенными внутри окна

**Фокус при закрытии окна**
- При закрытии окна фокус должен быть помещён на элемент, вызвавший модальное окно


## Подложка окна
**Элемент**
- Подложкой может выступать сам элемент модального окна или отдельный элемент в конце `<body>` (его можно создавать автоматически через JS)


## Кнопки внутри окна
**Кнопка "Закрыть"**
- Просто закрывает окно
- Таких кнопок может быть любое количество
- Обозначается атрибутом "data-close-btn"
- Пример: кнопка "Отмена"

**Кнопка с фокусом (для "Enter")**
- Получает фокус при открытии окна, что позволяет сразу активировать её нажатием "Enter"
- Обозначается атрибутом "data-focus"
- Пример: кнопка "Ок"

**Кнопка для "Ctrl+Enter"**
- Активируется нажатием "Ctrl+Enter" на клавиатуре
- Уместно использовать, когда в окне есть другие интерактивные элементы
- В окне может быть одна такая кнопка
- Обозначается атрибутом "data-ctrl-enter-btn"
- Пример: кнопка "Отправить на модерацию", кнопка "Опубликовать"


## TODO
- Режим открытия модального окна, при котором клик по фону не закрывает окно (например, когда нужно ввести какие-то данные)
- Последовательное открытие нескольких модальных окон
  - Удобно сделать фон в виде отдельного элемента в конце body
- При открытии 3 окна из-за фокуса на мобильном открывается клавиатура
- (ПОКА НЕ НУЖНО) Измерение ширины скроллбара и добавление правого отступа у "body"


## Источники (статьи)
- [ ] Делаем модальные окна для сайта. Заботимся об удобстве и доступности ([ссылка](https://habr.com/ru/post/519662/))
- [ ] Вы не знаете как должны работать модальные окна ([ссылка](https://habr.com/ru/post/521422/))
- [x] Видео - Знакомьтесь, модальное окно, Анна Селезнёва ([ссылка](https://youtu.be/s6PI8pKQxgo))
- [ ] Creating An Accessible Dialog From Scratch ([ссылка](https://www.smashingmagazine.com/2021/07/accessible-dialog-from-scratch/))
- [ ] Inclusive components: making modals accessible ([ссылка](https://dev.to/alenanik/inclusive-components-making-modals-accessible-1hn9))